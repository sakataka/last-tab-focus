# Last Tab Focus Chrome拡張機能 実装チェックリスト

## Phase 1: 基本セットアップ (25%)

### 1.1 プロジェクト構造の確認
- [x] プロジェクトディレクトリの確認
- [x] 必要なファイル構造の把握
- [x] Git初期化の確認

### 1.2 manifest.json作成
- [x] Manifest V3の基本構造作成
- [x] 拡張機能の基本情報設定
  - [x] name, version, description設定
  - [x] manifest_version: 3指定
- [x] 権限設定
  - [x] tabs権限追加
  - [x] activeTab権限追加（必要に応じて）
- [x] background script設定
  - [x] service_worker指定
  - [x] background.js指定
- [x] アイコン設定
  - [x] icons配列設定
  - [x] 16x16, 48x48, 128x128サイズ指定

### 1.3 アイコンファイルの準備
- [x] iconsディレクトリ作成
- [x] 16x16アイコン作成/配置
- [x] 48x48アイコン作成/配置
- [x] 128x128アイコン作成/配置
- [x] アイコンファイル形式確認（PNG推奨）

## Phase 2: コア機能実装 (40%)

### 2.1 background.js基本構造作成
- [x] ファイル作成
- [x] ES6モジュール形式での記述
- [x] 基本的なサービスワーカー構造
- [x] Chrome API利用可能性確認
- [x] 初期化処理の枠組み作成

### 2.2 データ構造設計
- [x] タブ履歴配列の設計
  - [x] tabHistory配列定義
  - [x] 最新タブが先頭の構造確認
- [x] ウィンドウ別履歴管理の検討
- [x] データ永続化の必要性検討

### 2.3 基本イベントリスナー設定
- [x] chrome.tabs.onActivated設定
  - [x] イベントリスナー関数作成
  - [x] 基本的な履歴追加処理
- [x] chrome.tabs.onRemoved設定
  - [x] イベントリスナー関数作成
  - [x] 基本的な履歴削除処理
- [x] chrome.windows.onRemoved設定（必要に応じて）

## Phase 3: ロジック実装 (25%)

### 3.1 タブフォーカス履歴管理
- [x] addToHistory関数実装
  - [x] 新しいタブIDを履歴先頭に追加
  - [x] 既存のタブIDが存在する場合の処理
  - [x] 履歴サイズ制限の実装
- [x] removeFromHistory関数実装
  - [x] 指定タブIDを履歴から削除
  - [x] 配列の整合性維持
- [x] getNextTab関数実装
  - [x] 履歴から次のアクティブタブ決定
  - [x] 無効なタブIDのスキップ処理

### 3.2 タブアクティブ時の処理
- [x] onTabActivated関数詳細実装
  - [x] タブ情報の取得
  - [x] 履歴への追加処理
  - [x] ウィンドウ情報の考慮
- [x] 重複除去ロジック
- [x] パフォーマンス最適化

### 3.3 タブクローズ時の処理
- [x] onTabRemoved関数詳細実装
  - [x] クローズされたタブの履歴からの削除
  - [x] アクティブタブかどうかの判定
  - [x] 次にフォーカスするタブの決定
- [x] フォーカス切り替え実行
  - [x] chrome.tabs.update使用
  - [x] active: trueで切り替え
- [x] エッジケースの処理

## Phase 4: エラーハンドリング・テスト (10%)

### 4.1 エラーハンドリング実装
- [x] 無効なタブIDへの対応
  - [x] chrome.tabs.get()でのエラーハンドリング
  - [x] 存在しないタブIDの除去
- [x] 権限エラーへの対応
- [x] 非同期処理のエラーハンドリング
- [x] try-catch文の適切な配置
- [x] ログ出力の実装（開発用）

### 4.2 基本動作テスト
- [x] Chrome拡張機能としての読み込みテスト
- [x] 単一ウィンドウでの動作確認
  - [x] タブ作成→フォーカス→クローズの一連動作
  - [x] 複数タブでの履歴管理確認
- [x] デバッグ用コンソール出力確認
- [x] パフォーマンステスト

### 4.3 複数ウィンドウ対応テスト
- [x] 複数ウィンドウ環境での動作確認
- [x] ウィンドウ間のタブフォーカス移動テスト
- [x] ウィンドウクローズ時の処理確認
- [x] 履歴管理の整合性確認

### 4.4 最終確認・最適化
- [x] コードレビュー・リファクタリング
- [x] 不要なコード・コメントの削除
- [x] パフォーマンス最適化
- [x] セキュリティチェック
- [x] Chrome Web Storeガイドライン準拠確認

---

## 実装時の注意事項

- Manifest V3のサービスワーカー制限に注意
- chrome.tabs APIの非同期処理を適切に処理
- メモリ使用量を最小限に抑制
- エラー時のフォールバック処理を確実に実装
- ユーザビリティを損なわない動作を心がける

## 完了基準

- [x] 全チェック項目の完了
- [x] 基本的なタブフォーカス機能の動作確認
- [x] エラーなく拡張機能が読み込まれる
- [x] 複数の使用パターンでの動作テスト完了